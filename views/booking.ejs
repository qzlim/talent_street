<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Talent Street</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link href="/assets/img/favicon.png" rel="icon">
    <link href="/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
    <link href="/assets/vendor/aos/aos.css" rel="stylesheet">

    <!-- Main CSS File -->
    <link href="/assets/css/main.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <!-- Bootstrap CDN -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Bootstrap Datepicker CDN -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>


    <!-- Main JS File -->
    <script src="/assets/js/main.js"></script>

</head>

<body class="booking" data-bs-spy="scroll" data-bs-target="#navmenu">

    <!-- ======= Header ======= -->
    <header id="header" class="header sticky-top d-flex align-items-center">
        <%- include('navbar.ejs') %>
    </header><!-- End Header -->

    <main id="main">
        <div data-aos="fade" class="page-title">
            <nav class="breadcrumbs">
                <div class="container">
                    <ol>
                        <li><a href="/lessondetails/<%= lesson_id %>">Back</a></li>
                    </ol>
                </div>
            </nav>
        </div><!-- End Page Title -->
        
        <!-- booking Section - booking Page -->
        <section id="booking" class="booking">

            <div class="container" data-aos="fade-up" data-aos-delay="100">
                <div class="row g-5">

                    <div class="col-lg-9">

                        <div class="details-container">
                            <h6 class="title">Date</h6>

                            <div class="row">
                                <div class="col-md-12">
                                    <p>* You are only able to choose a date starting tomorrow.</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="input-group details-date date-selection-box">
                                        <input type="text" data-toggle="datepicker" placeholder="Select date"
                                            id="example" class="form-control">
                                        <span class="input-group-text"><i
                                                class="bi bi-calendar input-prefix"></i></span>
                                    </div>
                                </div>
                            </div>


                        </div>
                        <div class="details-container">
                            <h6 class="title">Time</h6>
                            <div class="d-flex details-time">
                                <div class="time selection-box" id="box1">8am</div>
                                <div class="time selection-box" id="box2">10am</div>
                                <div class="time selection-box" id="box3">12pm</div>
                                <div class="time selection-box" id="box4">2pm</div>
                                <div class="time selection-box" id="box5">4pm</div>
                                <div class="time selection-box" id="box6">6pm</div>
                            </div>

                        </div>
                        <div class="details-container">
                            <h6 class="title">Duration</h6>
                            <div class="d-flex details-duration">
                                <div class="dur selection-box" id="box7">60 minutes</div>
                                <div class="dur selection-box" id="box8">120 minutes</div>
                            </div>

                        </div>

                    </div>

                    <div class="col-lg-3">

                        <div class="sidebar">

                            <div class="sidebar-item">
                                <h3 id="teacher" class="sidebar-title">
                                    <%= teacherName %>
                                </h3>
                                <p id="lesson_id" style="display:none"><%= lesson_id %></p>
                                <br>
                                <h5 class="rating"><span class="bi bi-star"></span>&nbsp;Rating <%= rating %>
                                </h5>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item">
                                <hr>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item">
                                <h4 class="sidebar-title">Location:
                                    <br>
                                    <span id="location" style="color:red">
                                        <%= location %>
                                    </span>
                                </h4>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item">
                                <hr>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item">
                                <h4 class="sidebar-title">Subject:
                                    <br>
                                    <span id="subcategory" style="color:red">
                                        <%= subcategoryTitle %>
                                    </span>
                                </h4>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item">
                                <hr>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item">
                                <h4 class="sidebar-title">Price :
                                    <br>
                                    <span id="price" style="color: var(--primary-color);">

                                        RM<%= price %>/hr</span>
                                </h4>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item">
                                <hr>
                            </div><!-- End sidebar item-->

                            <div class="sidebar-item booking">
                                <button class="btn btn-primary btn-getstarted" id="book-button" disabled>Book</button>
                            </div><!-- End sidebar item-->

                        </div><!-- End Sidebar -->

                    </div>
                </div>
            </div><!-- End booking posts list -->

            </div>

        </section><!-- End booking Section -->

    </main>

    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
        <p class="col-md-4 mb-0 text-body-secondary">Â© 2023 Talent Street</p>

        <a href="/index.html"
            class="col-md-4 d-flex align-items-center justify-content-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
            <i class="fa fa-superpowers" aria-hidden="true"></i>
        </a>

        <ul class="nav col-md-4 justify-content-end">
            <li class="nav-item"><a href="/" class="nav-link px-2 text-body-secondary">Home</a></li>
            <li class="nav-item"><a href="/index.html#category" class="nav-link px-2 text-body-secondary">Category</a>
            </li>
            <li class="nav-item"><a href="/index.html#about" class="nav-link px-2 text-body-secondary">About</a></li>
            <li class="nav-item"><a href="/index.html#howitworks" class="nav-link px-2 text-body-secondary">How It
                    Works</a></li>
        </ul>
    </footer>

    <!-- Scroll Top Button -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <!-- Preloader -->
    <div id="preloader">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>

    <!-- Vendor JS Files -->
    <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="/assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="/assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="/assets/vendor/aos/aos.js"></script>
    <script src="/assets/vendor/php-email-form/validate.js"></script>

    <script type="text/javascript">
        function checkBookingConditions() {
            const isDateSelected = $('.date-selection-box input').val() !== '';
            const isTimeSelected = $('.time.selected').length > 0;
            const isDurationSelected = $('.dur.selected').length > 0;

            // Enable the "Book" button if all conditions are met
            if (isDateSelected && isTimeSelected && isDurationSelected) {
                $('#book-button').prop('disabled', false);
            } else {
                $('#book-button').prop('disabled', true);
            }
        }

        $(document).ready(function () {
            let selectedDate = '';
            let selectedTime = '';
            let selectedDuration = '';
            let teacher = $('#teacher').text().trim();
            let subcategory = $('#subcategory').text().trim();
            let location = $('#location').text().trim();
            let price = $('#price').text().trim();
            let lesson_id = $('#lesson_id').text().trim();

            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            $('[data-toggle="datepicker"]').datepicker({
                format: 'dd/mm/yyyy',
                inline: true,
                orientation: 'bottom',
                startDate: tomorrow
            });

            $('.date-selection-box input').on('change', function () {
                selectedDate = $(this).val();
                checkBookingConditions();
            });

            $('.time').click(function () {
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected'); // Deselect the clicked box
                } else {
                    $('.time').removeClass('selected');
                    $(this).addClass('selected'); 
                    selectedTime = $(this).text();
                }
                checkBookingConditions();
            });

            $('.dur').click(function () {
                if ($(this).hasClass('selected')) {
                    $(this).removeClass('selected'); 
                } else {
                    $('.dur').removeClass('selected');
                    $(this).addClass('selected');
                    selectedDuration = $(this).text();
                }
                checkBookingConditions();
            });

            $('#book-button').on('click', function () {
                const bookingData = {
                    date: selectedDate,
                    time: selectedTime,
                    duration: selectedDuration,
                    teacher: teacher,
                    subcategory: subcategory,
                    location, location,
                    price: price,
                    lesson_id: lesson_id
                };
                const isConfirmed = confirm('Confirm your booking. Are you sure?');
                if (isConfirmed) {

                    $.ajax({
                        type: 'POST',
                        url: '/booking/set-has-booking',
                        data: JSON.stringify(bookingData),
                        contentType: 'application/json',
                        success: function (response) {
                            if (response.redirectUrl) {
                                window.location.href = response.redirectUrl;
                            }
                        },
                        error: function (error) {
                            console.error('Error:', error);
                        }
                    });
                }
            });

        });







    </script>

</body>

</html>